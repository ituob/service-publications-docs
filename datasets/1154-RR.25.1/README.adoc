= OB 1154 RR.25.1 YAML schema

== Purpose

This document describes the YAML schema for the ITU RR.25.1 call sign pattern
data.

== Basic schema

Each YAML file represents the schema of one country.

== Data types

=== Group

// Description of the $defs/group object

=== Segment

// Description of the $defs/segment object

=== Code

// Description of the $defs/code object


== Root keys: `groups`, `codelists`

There are 2 root keys:

`groups`:: the call sign patterns.
There are 2 supported sub-keys: `amateur` and `experimental`.
Each of these items is an array of "group" objects.

e.g.

[source,yaml]
----
groups:
  amateur:
    - regex: OE[:amateur_area:][:upper:]{2,3}
      criteria:
      - key: "1"
        segment_type: string
        value: OE
      - key: "2"
        segment_type: codelist
        codelist: amateur_area
      - key: "3"
        segment_type: range
        range:
          from: A
          to: Z
          cardinality: 2-3
----

[source,yaml]
----
groups:
  amateur:
    - name: Class 1 licence
      regex: V31[:upper]{2}

    - name: Class 2 licence
      regex: V32[:upper]{2}
----


`codelists`:: call sign code lists. Call signs in some countries
refer to code lists to designate regions or usage.
The structure of this is a dictionary of `{pattern}: {purpose}`.
There can be multiple code lists in the same country.

e.g.

[source,yaml]
----
codelists:
  - name: city_region
    list:
      - name: City of Minsk
        code: "1"
      - name: Minsk Region
        code: "2"
      - name: Brest Region
        code: "3"
      - name: Grodno Region
        code: "4"
      - name: Vitebsk Region
        code: "5"
      - name: Mogilev Region
        code: "6"
      - name: Gomel Region
        code: "7"
----

[source,yaml]
----
codelists:
  - name: amateur_area
    list:
      - name: Vienna (amateur stations only)
        code: "1"
        // ...
      - name: extraterritorial (on board ships or on board aircraft)
        code: "0"

  - name: experimental_area
    list:
      - name: Salzburg
        code: "2"
        // ...
      - name: Vorarlberg
        code: "9"
----



== Call-sign schema objects

A call-sign schema object is like this:

[source,yaml]
----
name: Automatic stations
regex: ON0[:upper:]{2,3}
----

Or

[source,yaml]
----
name: Foreign radio amateurs, visitors and short-term licence holders.
regex: 8P9[:upper:]{2}
criteria:
  - key: "1"
    segment_type: string
    value: 8P6
  - key: "2"
    segment_type: range
    range:
      from: A
      to: Z
      cardinality: "2"
----

Each "criteria" is a "segment" object.

If a call-sign schema has no name, just omit it:

(`bahrain.yaml`)
[source,yaml]
----
regex: A9[:digit:][0-9A-Z]{2,4}
criteria:
  - segment_type: string
    key: "1"
    value: A9
  - segment_type: range
    key: "2"
    range:
      from: 0
      to: 9
  - segment_type: enum
    key: "3"
    values:
      - segment_type: range
        range:
          from: 0
          to: 9
      - segment_type: range
        range:
          from: A
          to: Z
    cardinality: 2-4
----


The call-sign schema contains these keys:

`name`:: Name of the schema. Omit if empty.

`criteria`:: The criteria of the schema.


== Criteria objects

=== General

Each criteria object is composed of `name`, `regex` or `criteria`.

e.g.
[source,yaml]
----
groups:
  amateur:
    - name: National radio amateurs
      regex: 8P6[:upper:]{2}
      criteria:
        - segment_type: string
          key: "1"
          value: 8P6
        - segment_type: range
          key: "2"
          range:
            from: A
            to: Z
            cardinality: 2
----

=== Simple criteria (regex)

The simple form of a criteria object is definable in a regular expression.

`regex`:: The regular expression (RegEx) that expresses the call-sign schema.

There are 2 regex group operators that can be used:

* `[:digit:]`: to match digits (0-9)

* `[:upper:]`: to match uppercase letters (A-Z)

Regex references used in the form of `[:name:]` are references to the defined codelists (the `name` property of a codelist defined in the `codelists` section). e.g. `[:city_region:]` for a code-list named `city_region`.

If there are two regexes, split the object:

[source,yaml]
----
- name: Supplementary call signs for class 1 stations (1)
  regex: O[OPQS]0[:upper:]

- name: Supplementary call signs for class 1 stations (2)
  regex: O[RT][0-46-9][:upper:]
----



=== Complex criteria

Some call-sign schemas are too complex to be expressed in a single regex.
In this case, the `criteria` key is used to define the criteria in a more complex way.

The `criteria` key is an array of `segment` objects.

Each `segment` object at the criteria level requires a `key` property which is
the matching part of the call sign.

There are 4 types of `segment` objects:

`string`:: a string value (e.g. `VK`, `OE`, `8P6`). Requires the `key` and `value` properties.

`range`:: a range of values (e.g. `A-Z`, `0-9`, `2-3`). Requires the `key` and `range` properties. The `range` property is an object with `from`, `to` and `cardinality` properties (one of `from` and `cardinality` required).
+
NOTE: The `from`, `to` and `cardinality` properties are all strings. The `cardinality` may be a range (e.g. `2-3`) or a single value (e.g. `2`).

`codelist`:: a reference to a code list (e.g. `amateur_area`, `city_region`). Requires the `key` and `codelist` properties. This means that the code list must already be defined in the `codelists` section of the YAML file (this needs to be validated).

`enum`:: an array of segments, each of which is a `string`, `range` or `codelist` segment. These segment objects do not have the `key` property.

.Call sign pattern in complex criteria from regex
[example]
====
The regex `8P9[:upper:]{2}` can be expanded into:

[source,yaml]
----
regex: 8P9[:upper:]{2}
criteria:
  - segment_type: string
    key: "1"
    value: 8P6
  - segment_type: range
    key: "2"
    range:
      from: A
      to: Z
      cardinality: "2"
----
====


.Call sign pattern that refers to code-lists
[exmaple]
====
[source,yaml]
----
criteria:
  - segment_type: string
    key: "1"
    value: OE
  - segment_type: codelist
    key: "2"
    codelist: amateur_area
  - segment_type: range
    key: "3"
    range:
      from: A
      to: Z
      cardinality: 2-3
----
====

.Call sign pattern using an enum with string ranges
[example]
====
[source,yaml]
----
criteria:
  - segment_type: enum
    key: "1"
    values:
    - segment_type: string
      value: VK
    - segment_type: string
      value: AX
    - segment_type: string
      value: VI
  - segment_type: codelist
    key: "2"
    codelist: amateur_area
  - segment_type: enum
    key: "3"
    values:
    - segment_type: range
      range:
        from: A
        to: G
    - segment_type: range
      range:
        from: I
        to: K
    - segment_type: range
      range:
        from: S
        to: U
    - segment_type: range
      range:
        from: W
        to: Z
  - segment_type: range
    key: "4"
    range:
      from: A
      to: Z
      cardinality: 2-3
----
====

== License and copyright

Original data is copyright to the ITU.

All other content and processing code, copyright Ribose.
